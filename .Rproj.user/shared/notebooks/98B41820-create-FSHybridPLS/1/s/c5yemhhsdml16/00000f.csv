"0","#' Compute V matrix (pre-corrected covariance estimator)"
"0","#'"
"0","#' Constructs the V matrix involving inner products of functional predictors"
"0","#' (weighted by their Gram matrices) and scalar predictors against response y."
"0","#'"
"0","#' @param W A `predictor_hybrid` object."
"0","#' @param y A numeric response vector of length equal to number of samples."
"0","#'"
"0","#' @return A matrix representing the corrected cross-covariance structure."
"0","#' @export"
"0","get_pre_corrcov <- function(W, y){"
"0","  n <- W$n_sample"
"0","  K <- W$n_functional"
"0",""
"0","  # building blocks"
"0","  ## C_J : C multiplied by J. Scalable to arbitrary K"
"0","  C_J <- get_CJ(W)"
"0",""
"0","  "
"0","  ## covariance"
"0","  J_Ct_y <- t(C_J) %*% y"
"0","  Zt_y <- t(W$Z) %*% y"
"0",""
"0","  # V matrix"
"0","  upper_left <- J_Ct_y %*% t(J_Ct_y)"
"0","  upper_right <- J_Ct_y %*% t(Zt_y)"
"0","  lower_left <- t(upper_right)"
"0","  lower_right <- Zt_y %*% t(Zt_y)"
"0",""
"0","  V_star <- cbind("
"0","    rbind(upper_left, lower_left),"
"0","    rbind(upper_right, lower_right)"
"0","    )/(n^2)"
"0",""
"0","  return(V_star)"
"0","  }"
