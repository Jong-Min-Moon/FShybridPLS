"0","# R Equivalence Test for curve_normalize implementations"
"0","# NOTE: This script requires the 'fda' package to run the functional data simulation."
"0",""
"0","# --- 1. Define the two functions for comparison ---"
"0",""
"0","# Version 1: Deprecated (Coefficient Manipulation)"
"0","curve_normalize_v1 <- function(functional, mean_functional, deno) {"
"0","  # Type checks removed for brevity in this test, as they are not the focus."
"0","  "
"0","  # Operation using coefficient subtraction and manual broadcasting"
"0","  functional_normalized <- fda::fd(coef ="
"0","    fda::coef(functional) - fda::coef(mean_functional) %*% matrix(1, ncol = ncol(fda::coef(functional))),"
"0","    basisobj = functional$basis"
"0","  )"
"0","  functional_normalized <- fda::times.fd(1/deno, functional_normalized)"
"0","  return(functional_normalized)"
"0","}"
"0",""
"0","# Version 2: Modern (fda S3 Methods)"
"0","curve_normalize_v2 <- function(functional, mean_functional, deno) {"
"0","  # Type checks removed for brevity in this test."
"0","  "
"0","  # 1. Centering: functional - mean_functional (uses fda::minus.fd)"
"0","  centered_functional <- fda::minus.fd(functional, mean_functional)"
"0","  "
"0","  # 2. Scaling: (1/deno) * centered_functional (uses fda::times.fd)"
"0","  functional_normalized <- fda::times.fd(1/deno, centered_functional)"
"0","  "
"0","  return(functional_normalized)"
"0","}"
"0",""
"0","# --- 2. Setup Mock Data (Requires 'fda' package) ---"
"0","if (requireNamespace(""fda"", quietly = TRUE)) {"
"0","  "
"0","  N_SAMPLES <- 25 # Total number of observations"
"0","  "
"0","  # Functional Data Setup"
"0","  basis_obj <- fda::create.bspline.basis(rangeval = c(0, 10), nbasis = 7)"
"0","  "
"0","  # 1. Create coefficients for N_SAMPLES"
"0","  data_coefs <- matrix(rnorm(N_SAMPLES * 7, mean = 10, sd = 5), nrow = 7, ncol = N_SAMPLES)"
"0","  "
"0","  # 2. Create the main functional data object"
"0","  data_functional <- fda::fd(coef = data_coefs, basisobj = basis_obj)"
"0","  "
"0","  # 3. Calculate the mean function (this is a single-sample fd object)"
"0","  mean_functional_obj <- fda::mean.fd(data_functional)"
"0","  "
"0","  # 4. Calculate a mock denominator (L2 norm of SD for robust scaling)"
"0","  sd_functional_obj <- fda::sd.fd(data_functional)"
"0","  mock_deno <- sqrt(fda::inprod(sd_functional_obj, sd_functional_obj))"
"0","  "
"0","  cat(""--- Mock Functional Data Setup Complete ---\n"")"
"0","  cat(""Number of samples (N):"", N_SAMPLES, ""\n"")"
"0","  cat(""Denominator (deno):"", mock_deno, ""\n\n"")"
"0","  "
"0","  # --- 3. Run Comparison Test ---"
"0","  "
"0","  cat(""Running equivalence test...\n"")"
"0","  "
"0","  tryCatch({"
"0","    # Run both versions"
"0","    result_v1 <- curve_normalize_v1(data_functional, mean_functional_obj, mock_deno)"
"0","    result_v2 <- curve_normalize_v2(data_functional, mean_functional_obj, mock_deno)"
"0","    "
"0","    # Extract coefficient matrices for comparison"
"0","    coefs_v1 <- fda::coef(result_v1)"
"0","    coefs_v2 <- fda::coef(result_v2)"
"0","    "
"0","    # Use all.equal for robust numerical comparison of matrices"
"0","    comparison_result <- all.equal(coefs_v1, coefs_v2)"
"0","    "
"0","    # Check if the comparison is TRUE (meaning the matrices are effectively identical)"
"0","    if (isTRUE(comparison_result)) {"
"0","      cat(""Test Passed: The coefficient matrices of the two normalization methods are numerically identical.\n"")"
"0","    } else {"
"0","      cat(""Test FAILED: The results are different.\n"")"
"0","      # Print the detailed difference provided by all.equal"
"0","      print(comparison_result)"
"0","    }"
"0","    "
"0","  }, error = function(e) {"
"0","    cat(""Test Encountered an Error: "", conditionMessage(e), ""\n"")"
"0","  })"
"0","  "
"0","  cat(""\n--- Equivalence Test Complete ---\n"")"
"0","  "
"0","} else {"
"0","  cat(""Skipping tests: 'fda' package not found. Please install and load 'fda' to run the test cases.\n"")"
"0","}"
"1","--- Mock Functional Data Setup Complete ---
"
"1","Number of samples (N):"
"1"," "
"1","25"
"1"," "
"1","
"
"1","Denominator (deno):"
"1"," "
"1","10.3604"
"1"," "
"1","

"
"1","Running equivalence test...
"
"1","Test Encountered an Error: "
"1"," "
"1","'coef' is not an exported object from 'namespace:fda'"
"1"," "
"1","
"
"1","
--- Equivalence Test Complete ---
"
