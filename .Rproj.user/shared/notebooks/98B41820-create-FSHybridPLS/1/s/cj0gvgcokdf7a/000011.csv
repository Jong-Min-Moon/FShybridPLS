"0","#' @export"
"0","#' "
"0","#' "
"0","# --- 1. Define the S4 Generic Function ---"
"0","# This must be run first to tell R that 'add_broadcast' is a function "
"0","# that can have methods defined for different classes."
"0","setGeneric(""add_broadcast"", function(input, other, alpha = 1) {"
"0","  standardGeneric(""add_broadcast"")"
"0","})"
"1","[1]"
"1"," ""add_broadcast"""
"1","
"
"0","# --- 2. Define the S4 Method for 'matrix' Class ---"
"0","setMethod(""add_broadcast"", ""matrix"","
"0","###########################################"
"0","function(input, other, alpha = 1){"
"0","  "
"0","  # 1. Structural Check: Ensure RHS is a single observation."
"0","  # This uses length() for vectors, and dim()[1] for matrices."
"0","  is_matrix_other <- is.matrix(other)"
"0","  if (is_matrix_other && dim(other)[1] > 1) {"
"0","    stop(""RHS must have a single observation (row)."")"
"0","  }"
"0","  "
"0","  # 2. Conversion: Convert a single-row matrix into a vector for broadcasting."
"0","  # If 'other' is already a vector, this does nothing."
"0","  # If 'other' is a 1xP matrix, this flattens it into a length-P vector."
"0","  if (is_matrix_other) {"
"0","    other <- as.vector(other) "
"0","  }"
"0","  "
"0","  # 3. Native Arithmetic: Use simple R arithmetic for high performance."
"0","  # R broadcasts the vector 'other' across the rows of the matrix 'input'."
"0","  return( t( t(input) + alpha * other))"
"0","}"
"0","###########################################"
"0",")"
"0",""
