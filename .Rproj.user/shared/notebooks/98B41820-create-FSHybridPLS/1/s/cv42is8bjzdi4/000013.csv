"0","#' --- Dependencies for Testing ---"
"0","library(fda) # Required for mock functional data"
"0",""
"0","# Placeholder for a minimal predictor_hybrid constructor for testing purposes"
"0",""
"0","# --- Test Script Start ---"
"0",""
"0","# 1. Setup Mock Data"
"0","N_train <- 100"
"0","N_test <- 50"
"0","N_scalar <- 2"
"0","N_functional <- 1"
"0",""
"0","# Create Functional Data (Needs to be present but remain untouched)"
"0","basis_obj <- create.bspline.basis(rangeval = c(0, 10), nbasis = 7)"
"0","train_coefs <- matrix(rnorm(N_train * 7), nrow = 7)"
"0","test_coefs <- matrix(rnorm(N_test * 7), nrow = 7)"
"0","mock_fd_train <- fd(train_coefs, basis_obj)"
"0","mock_fd_test <- fd(test_coefs, basis_obj)"
"0",""
"0","# Create Scalar Data (Crucial for the test)"
"0","# Training data has a clear mean and SD"
"0","Z_train <- matrix(rnorm(N_train * N_scalar, mean = c(5, 10), sd = c(2, 3)), "
"0","                  nrow = N_train, ncol = N_scalar, byrow = TRUE)"
"0","# Testing data has different properties (must be normalized by train stats)"
"0","Z_test <- matrix(rnorm(N_test * N_scalar, mean = c(1, 1), sd = c(10, 10)), "
"0","                 nrow = N_test, ncol = N_scalar, byrow = TRUE)"
"0",""
"0","# Create Hybrid Objects"
"0","W_train <- predictor_hybrid(Z = Z_train, functional_list = list(mock_fd_train))"
"0","W_test <- predictor_hybrid(Z = Z_test, functional_list = list(mock_fd_test))"
"0",""
"0","# Store original Z for comparison"
"0","Z_train_original <- W_train$Z"
"0","Z_test_original <- W_test$Z"
"0",""
"0","# 2. Run the Function Under Test"
"0","W_normalized_list <- scalar_normalize_train_test(W_train, W_test)"
"0","W_train_norm <- W_normalized_list$train"
"0","W_test_norm <- W_normalized_list$test"
"0",""
"0","# 3. Verification and Assertions"
"0",""
"0","cat(""--- Running Verification Checks ---\n"")"
"1","--- Running Verification Checks ---
"
"0","# Check 1: Training set is correctly normalized (Mean ~ 0, SD ~ 1)"
"0","train_mean_norm <- colMeans(W_train_norm$Z)"
"0","train_sd_norm <- apply(W_train_norm$Z, 2, sd)"
"0",""
"0","stopifnot("
"0","  ""Train mean Col 1 not near 0"" = all(abs(train_mean_norm[1]) < 1e-10),"
"0","  ""Train mean Col 2 not near 0"" = all(abs(train_mean_norm[2]) < 1e-10),"
"0","  ""Train SD Col 1 not near 1"" = all(abs(train_sd_norm[1] - 1) < 1e-10),"
"0","  ""Train SD Col 2 not near 1"" = all(abs(train_sd_norm[2] - 1) < 1e-10)"
"0",")"
"0","cat(""Check 1: Training set Z-score normalization successful (Mean~0, SD~1).\n"")"
"1","Check 1: Training set Z-score normalization successful (Mean~0, SD~1).
"
"0","# Check 2: Functional components are untouched"
"0","stopifnot("
"0","  ""Functional list should not change"" = isTRUE(all.equal("
"0","    W_train$functional_list[[1]]$coefs, "
"0","    W_train_norm$functional_list[[1]]$coefs"
"0","  ))"
"0",")"
"0","cat(""Check 2: Functional components successfully preserved.\n"")"
"1","Check 2: Functional components successfully preserved.
"
"0","# Check 3: Test set is normalized using TRAIN statistics (crucial consistency check)"
"0",""
"0","# Recalculate the training statistics"
"0","train_mean_recalc <- get_mean(Z_train_original)"
"0","train_sd_recalc <- get_sd(Z_train_original)"
"0",""
"0","# Manually normalize the test set using TRAIN stats"
"0","Z_test_expected <- t( (t(Z_test_original) - train_mean_recalc) / train_sd_recalc)"
"0",""
"0","# Compare the function's output (W_test_norm$Z) against the manual calculation"
"0","stopifnot("
"0","  ""Test set normalization mismatch"" = isTRUE(all.equal(W_test_norm$Z, Z_test_expected))"
"0",")"
"0","cat(""Check 3: Test set correctly normalized using only Training statistics.\n"")"
"1","Check 3: Test set correctly normalized using only Training statistics.
"
"0","cat(""--- All tests passed successfully! ---\n"")"
"1","--- All tests passed successfully! ---
"
