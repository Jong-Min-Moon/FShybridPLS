"0","#' Normalize the scalar component (Z) of hybrid predictors using training set statistics."
"0","#'"
"0","#' @param predictor_train A `predictor_hybrid` object (train set)."
"0","#' @param predictor_test A `predictor_hybrid` object (test set)."
"0","#' @return A list containing the normalized 'train' and 'test' hybrid objects."
"0","#' @export"
"0","scalar_normalize_train_test <- function(predictor_train, predictor_test){"
"0","  "
"0","  # Type and structure checks"
"0","  stopifnot("
"0","    inherits(predictor_train, ""predictor_hybrid""),"
"0","    inherits(predictor_test, ""predictor_hybrid""),"
"0","    predictor_train$n_scalar == predictor_test$n_scalar"
"0","  )"
"0","  "
"0","  # Create copies for modification"
"0","  predictor_train_normalized <- predictor_train"
"0","  predictor_test_normalized <- predictor_test"
"0","  "
"0","  # 1. Calculate statistics from the TRAINING set only"
"0","  mean_train <- colMeans(predictor_train$Z)"
"0","  sd_train <- apply(predictor_train$Z, 2, sd)"
"0","  "
"0","  # 2. Apply normalization to the TRAINING set"
"0","  predictor_train_normalized$Z <-"
"0","    scalar_normalize("
"0","      predictor_train$Z,"
"0","      mean_train,"
"0","      sd_train"
"0","    )"
"0","  "
"0","  # 3. Apply normalization to the TEST set using TRAIN statistics"
"0","  predictor_test_normalized$Z <-"
"0","    scalar_normalize("
"0","      predictor_test$Z,"
"0","      mean_train, # IMPORTANT: Use train mean"
"0","      sd_train    # IMPORTANT: Use train SD"
"0","    )"
"0","  "
"0","  return("
"0","    list("
"0","      predictor_train = predictor_train_normalized,"
"0","      predictor_test = predictor_test_normalized,"
"0","      mean_train = mean_train,"
"0","      sd_train = sd_train"
"0","    )"
"0","  )"
"0","}"
