"0","#' calcMFPCA_predict"
"0","#' @export"
"0","#' "
"0","calcMFPCA_predict <- function(N, p, M, weights, npc, uniBasis,"
"0","                              normFactors_train, vectors_train, values_train)"
"0","{"
"0","  # combine all scores"
"0","  allScores <- foreach::foreach(j = seq_len(p), .combine = ""cbind"")%do%{uniBasis[[j]]$scores.pred}"
"0",""
"0","  # block vector of weights"
"0","  allWeights <- foreach::foreach(j = seq_len(p), .combine = ""c"")%do%{rep(sqrt(weights[j]), npc[j])}"
"0",""
"0","  Z <- allScores %*% Matrix::Diagonal(x = allWeights) / sqrt(N-1)"
"0",""
"0",""
"0","  ### Calculate scores"
"0","  scores <- Z %*% vectors_train * sqrt(N-1) # see defintion of Z above!"
"0","  scores <- as.matrix(scores %*% diag(sqrt(values_train) * normFactors_train, nrow = M, ncol = M)) # normalization"
"0",""
"0","  return(scores)"
"0","}"
"0",""
