"0","get_rho <- function(d_vec, W){"
"0","  K <- W$n_functional"
"0","  M <- W$n_basis_list[[1]]"
"0","  n_scalar <- W$n_scalar"
"0","  n <- W$n_sample"
"0","  rho <- rep(0, n)"
"0","  "
"0","  #functional part"
"0","  for (j in 1:K){"
"0","    start_index <- (j-1)*M + 1"
"0","    end_index <- j*M"
"0","    gamma_j <- d_vec[ start_index : end_index]"
"0","    Theta_j  <- t(W$functional_list[[j]]$coefs)"
"0","    B <- W$gram_list[[j]]"
"0","    rho <- rho + Theta_j %*% B %*% gamma_j"
"0","  }"
"0","      "
"0","  #scalar part"
"0","  rho <- rho + W$Z %*% d_vec[(K * M + 1):length(d_vec)]"
"0","  return (rho)"
"0","}"
"0","     "
