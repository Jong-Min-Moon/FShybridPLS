"0","# Test script to showcase R's built-in broadcasting (recycling) rules."
"0",""
"0","# --- 1. Setup ---"
"0",""
"0","# An N x P matrix (4 rows, 3 columns)"
"0","N <- 4"
"0","P <- 3"
"0","A <- matrix("
"0","  1:12, "
"0","  nrow = N, "
"0","  ncol = P, "
"0","  byrow = TRUE,"
"0","  dimnames = list(paste0(""Row"", 1:N), paste0(""Col"", 1:P))"
"0",")"
"0",""
"0","# CRITICAL CHANGE: Define the small operand as a VECTOR of length P."
"0","B_vec <- c(100, 200, 300)"
"0",""
"0","# A scalar multiplier"
"0","alpha <- 0.5"
"0",""
"0","cat(""--- R Broadcasting Demonstration (Vector Correction) ---\n\n"")"
"1","--- R Broadcasting Demonstration (Vector Correction) ---

"
"0","cat(""Matrix A (4x3):\n"")"
"1","Matrix A (4x3):
"
"0","print(A)"
"1","    "
"1"," Col1"
"1"," Col2"
"1"," Col3"
"1","
Row1"
"1","    1"
"1","    2"
"1","    3"
"1","
Row2"
"1","    4"
"1","    5"
"1","    6"
"1","
Row3"
"1","    7"
"1","    8"
"1","    9"
"1","
Row4"
"1","   10"
"1","   11"
"1","   12"
"1","
"
"0","cat(""\nVector B_vec (length 3, NOT a matrix):\n"")"
"1","
Vector B_vec (length 3, NOT a matrix):
"
"0","print(B_vec)"
"1","[1]"
"1"," 100"
"1"," 200"
"1"," 300"
"1","
"
"0","cat(""\n--- Explanation of the previous error: ---\n"")"
"1","
--- Explanation of the previous error: ---
"
"0","cat(""When B was a 1x3 matrix, R required 4x3 + 4x3. The error was correct for matrix addition.\n"")"
"1","When B was a 1x3 matrix, R required 4x3 + 4x3. The error was correct for matrix addition.
"
"0","cat(""When B is a vector, R uses the 'recycling rule' and repeats the vector row-wise.\n"")"
"1","When B is a vector, R uses the 'recycling rule' and repeats the vector row-wise.
"
"0","# --- 2. Demonstration: Simple Addition (A + B_vec) ---"
"0",""
"0","# R automatically repeats B_vec 4 times across the rows of A. This works!"
"0","C_sum <- A + B_vec"
"0",""
"0","cat(""\n--- Result 1: A + B_vec (Native R Broadcasting Successful) ---\n"")"
"1","
--- Result 1: A + B_vec (Native R Broadcasting Successful) ---
"
"0","cat(""Expected: B_vec added to every row of A.\n"")"
"1","Expected: B_vec added to every row of A.
"
"0","print(C_sum)"
"1","    "
"1"," Col1"
"1"," Col2"
"1"," Col3"
"1","
Row1"
"1","  101"
"1","  202"
"1","  303"
"1","
Row2"
"1","  204"
"1","  305"
"1","  106"
"1","
Row3"
"1","  307"
"1","  108"
"1","  209"
"1","
Row4"
"1","  110"
"1","  211"
"1","  312"
"1","
"
"0","# Verification Test: Check the first row"
"0","expected_row1 <- A[1, ] + B_vec"
"0","actual_row1 <- C_sum[1, ]"
"0","stopifnot(isTRUE(all.equal(actual_row1, expected_row1)))"
"0","cat(""\nVerification: First row matches (1 + 100, 2 + 200, 3 + 300). SUCCESS.\n"")"
"1","
Verification: First row matches (1 + 100, 2 + 200, 3 + 300). SUCCESS.
"
"0","# --- 3. Demonstration: Addition with Scaling (A + alpha * B_vec) ---"
"0",""
"0","# R performs the scalar multiplication first, then broadcasts the resulting vector."
"0","C_scaled_sum <- t(t(A) + alpha * B_vec)"
"0",""
"0","cat(""\n--- Result 2: A + alpha * B_vec (Native R Broadcasting) ---\n"")"
"1","
--- Result 2: A + alpha * B_vec (Native R Broadcasting) ---
"
"0","cat(""Expected: Scaled B_vec ([50, 100, 150]) added to every row of A.\n"")"
"1","Expected: Scaled B_vec ([50, 100, 150]) added to every row of A.
"
"0","print(C_scaled_sum)"
"1","    "
"1"," Col1"
"1"," Col2"
"1"," Col3"
"1","
Row1"
"1","   51"
"1","  102"
"1","  153"
"1","
Row2"
"1","   54"
"1","  105"
"1","  156"
"1","
Row3"
"1","   57"
"1","  108"
"1","  159"
"1","
Row4"
"1","   60"
"1","  111"
"1","  162"
"1","
"
"0","# Verification Test: Check the second row"
"0","expected_scaled_row2 <- A[2, ] + alpha * B_vec"
"0","actual_scaled_row2 <- C_scaled_sum[2, ]"
"0","stopifnot(isTRUE(all.equal(actual_scaled_row2, expected_scaled_row2)))"
"0","cat(""\nVerification: Second row matches (4 + 50, 5 + 100, 6 + 150). SUCCESS.\n"")"
"1","
Verification: Second row matches (4 + 50, 5 + 100, 6 + 150). SUCCESS.
"
