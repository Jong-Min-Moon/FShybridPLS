"0","#' Create a predictor_hybrid object (S3 version, automatic basis size and Gram matrix)"
"0","#' Constructs a hybrid predictor object that stores both scalar and functional predictors,"
"0","#' and automatically computes Gram matrices (inner products of basis functions)."
"0","#'"
"0","#' @param Z A numeric matrix of dimension \code{n_sample Ã— n_scalar} representing scalar predictors."
"0","#' @param functional_list A list of functional predictors (e.g., \code{fd} objects from the \code{fda} package)."
"0","#'"
"0","#' @return An object of class \code{predictor_hybrid}, containing scalar and functional data with Gram matrices."
"0","#' @export"
"0","predictor_hybrid <- function(Z, functional_list) {"
"0","  stopifnot(is.matrix(Z), is.numeric(Z))"
"0","  stopifnot(is.list(functional_list))"
"0",""
"0","  n_sample <- nrow(Z)"
"0","  n_scalar <- ncol(Z)"
"0","  n_functional <- length(functional_list)"
"0",""
"0","  gram_list <- gram_deriv2_list <- vector(""list"", n_functional)"
"0","  n_basis_list <- numeric(n_functional)"
"0",""
"0","  for (i in seq_len(n_functional)) {"
"0","    fd_i <- functional_list[[i]]"
"0","    stopifnot(inherits(fd_i, ""fd""))"
"0",""
"0","    n_fd_sample <- ncol(coef(fd_i))"
"0","    if (n_fd_sample != n_sample) {"
"0","      stop(sprintf(""Functional predictor %d has %d replicates, but Z has %d rows."","
"0","                   i, n_fd_sample, n_sample))"
"0","    }"
"0",""
"0","    basis_i <- fd_i$basis"
"0","    gram_list[[i]] <- compute_gram_matrix(basis_i)"
"0","    gram_deriv2_list[[i]] <- fda::getbasispenalty(basis_i) # New  "
"0","      "
"0"," "
"0",""
"0","    n_basis_list[i] <- basis_i$nbasis"
"0","  }"
"0",""
"0","  structure("
"0","    list("
"0","      Z = Z,"
"0","      functional_list = functional_list,"
"0","      gram_list = gram_list,"
"0","      gram_deriv2_list = gram_deriv2_list, # Store the new list"
"0","      n_basis_list = n_basis_list,"
"0","      n_sample = n_sample,"
"0","      n_functional = n_functional,"
"0","      n_scalar = n_scalar"
"0","    ),"
"0","    class = ""predictor_hybrid"""
"0","  )"
"0","}"
