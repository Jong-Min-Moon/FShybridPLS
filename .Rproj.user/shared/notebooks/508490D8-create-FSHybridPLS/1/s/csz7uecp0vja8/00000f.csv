"0","#' Construct block-diagonal smoothing parameter matrix"
"0","#'"
"0","#' Generates a block-diagonal matrix with smoothing parameters applied to each "
"0","#' functional component. Each block is a scaled identity matrix, where the scaling "
"0","#' factor corresponds to the regularization parameter for that functional component. "
"0","#' The scalar components are not penalized and thus contribute a zero matrix block."
"0","#'"
"0","#' @param W A `predictor_hybrid` object."
"0","#' @param lambda A numeric vector of length equal to the number of functional components (`W$n_functional`), containing the smoothing parameters for each functional predictor."
"0","#'"
"0","#' @return A block-diagonal matrix of size `(total_dim Ã— total_dim)`, where the top-left blocks are scaled identity matrices for functional predictors and the bottom-right block is a zero matrix for scalar covariates."
"0","#' @export"
"0","get_smoothing_param_hybrid <- function(W, lambda) {"
"0","  if (!inherits(W, ""predictor_hybrid"")) {"
"0","    stop(""Input W must be of class 'predictor_hybrid'."")"
"0","  }"
"0",""
"0","  if (length(lambda) != W$n_functional) {"
"0","    stop(""Length of lambda must match the number of functional predictors."")"
"0","  }"
"0",""
"0","  lambda_blocks <- lapply(seq_len(W$n_functional), function(ii) {"
"0","    nb <- W$functional_list[[ii]]$basis$nbasis"
"0","    lambda[ii] * diag(nb)"
"0","  })"
"0",""
"0","  lambda_blocks[[W$n_functional + 1]] <- matrix(0, nrow = W$n_scalar, ncol = W$n_scalar)"
"0",""
"0","  Matrix::bdiag(lambda_blocks)"
"0","}"
