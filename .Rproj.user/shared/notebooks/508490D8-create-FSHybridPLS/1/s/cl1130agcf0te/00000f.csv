"0","get_xi_hat_linear <- function(W, y){"
"0","  n <- W$n_sample"
"0","  K <- W$n_functional"
"0","  d = list()"
"0","  for (i in 1:K){  ## tPhi_tC : C multiplied by Phi. Scalable to arbitrary K"
"0","    Ct <- W$functional_list[[i]]$coefs"
"0","    Phi <- W$gram_list[[i]]"
"0","    rhs <-  t(Phi) %*% Ct %*% y"
"0","    d[[i]] <- solve(Phi, rhs)"
"0","  }"
"0","  d[[K+1]] <- t(W$Z) %*% y"
"0","  d_vec <- do.call(c, d)  # or: unlist(d)"
"0","  return(d_vec)"
"0","}"
